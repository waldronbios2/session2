<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Session 2 lab exercise: Exploration of contraceptive use data • session2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Session 2 lab exercise: Exploration of contraceptive use data">
<meta property="og:description" content="session2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-176789980-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176789980-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">session2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lecture and Lab
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/session_lecture.html">Lecture notes</a>
    </li>
    <li>
      <a href="../articles/session_lecture.pdf">Lecture notes PDF</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/session_lab.html">Lab materials</a>
    </li>
  </ul>
</li>
<li class="dropdown-header">
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waldronbios2/session2/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/leviwaldron1">
    <span class="fab fa fab fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="session_lab_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="session_lab_files/table1-1.0/table1_defaults.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Session 2 lab exercise: Exploration of contraceptive use data</h1>
                        <h4 class="author">Levi Waldron</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waldronbios2/session2/blob/master/vignettes/session_lab.Rmd"><code>vignettes/session_lab.Rmd</code></a></small>
      <div class="hidden name"><code>session_lab.Rmd</code></div>

    </div>

    
    
<p><strong>Learning Objectives</strong></p>
<ol style="list-style-type: decimal">
<li>Define “tidy” data</li>
<li>Load a dataset in R and perform basic exploratory data analysis</li>
<li>Create descriptive “Table 1” of a study sample using the <code>table1</code> package</li>
<li>Create a customized bar plot using the <code>ggplot2</code> package</li>
</ol>
<p><strong>Exercises</strong></p>
<ol style="list-style-type: decimal">
<li>Load the contraceptive use dataset into R</li>
<li>Create an “Epi Table 1” of sample characteristics</li>
<li>Create a barplot stratified by age and showing the relative proportions of participants using contraceptives among those who do and do not want more children.</li>
<li>Repeat the barplot showing percentages instead of counts</li>
</ol>
<div id="load-the-contraceptive-use-data" class="section level1">
<h1 class="hasAnchor">
<a href="#load-the-contraceptive-use-data" class="anchor"></a>Load the contraceptive use data</h1>
<p>Load the data from <a href="http://data.princeton.edu/wws509/datasets/#cuse" class="uri">http://data.princeton.edu/wws509/datasets/#cuse</a>. From this page:</p>
<blockquote>
<p>These data show the distribution of 1607 currently married and fecund women interviewed in the Fiji Fertility Survey, according to age, education, desire for more children and current use of contraception.</p>
</blockquote>
<p>Unlike in the lecture, here I demonstrate reading the dataset using the <em>readr</em> package. It identifies some warnings because the header of this file has extra spaces at the end which appear like an extra column, making it appear like the dataset has 6 columns instead of 5. But the dataset reads with 5 columns as we want it to anyways, because I chose to skip the blank column 6 in the graphical interface (which added the code <code>X6 = col_skip()</code> below). <em>readr</em> is good for identifying problems like this in text data files.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># traditional method for loading data:</span>
<span class="co"># cuse &lt;- read.table("cuse.dat", header=TRUE)</span>
<span class="co"># Using readr package with "File - Import Dataset" and manually setting factor levels.</span>
<span class="co"># Note, you don't have to write all this code by hand! It was produced by the File - Import Dataset helper.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span>
<span class="va">cuse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html">read_table2</a></span><span class="op">(</span><span class="st">"cuse.dat"</span>,
    col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>
      age <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html">col_factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;25"</span>, <span class="st">"25-29"</span>, <span class="st">"30-39"</span>, <span class="st">"40-49"</span><span class="op">)</span><span class="op">)</span>,
      education <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html">col_factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span>,
      wantsMore <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html">col_factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"no"</span>, <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span>,
      X6 <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/col_skip.html">col_skip</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span></pre></div>
<pre><code>## Warning: Missing column names filled in: 'X6' [6]</code></pre>
<pre><code>## Warning: 16 parsing failures.
## row col  expected    actual       file
##   1  -- 6 columns 5 columns 'cuse.dat'
##   2  -- 6 columns 5 columns 'cuse.dat'
##   3  -- 6 columns 5 columns 'cuse.dat'
##   4  -- 6 columns 5 columns 'cuse.dat'
##   5  -- 6 columns 5 columns 'cuse.dat'
## ... ... ......... ......... ..........
## See problems(...) for more details.</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cuse</span><span class="op">)</span></pre></div>
<pre><code>##     age    education wantsMore    notUsing          using      
##  &lt;25  :4   low :8    no :8     Min.   :  8.00   Min.   : 4.00  
##  25-29:4   high:8    yes:8     1st Qu.: 31.00   1st Qu.: 9.50  
##  30-39:4                       Median : 56.50   Median :29.00  
##  40-49:4                       Mean   : 68.75   Mean   :31.69  
##                                3rd Qu.: 85.75   3rd Qu.:49.00  
##                                Max.   :212.00   Max.   :80.00</code></pre>
</div>
<div id="create-an-epi-table-1" class="section level1">
<h1 class="hasAnchor">
<a href="#create-an-epi-table-1" class="anchor"></a>Create an epi “Table 1”</h1>
<p>Here’s a simple way to create the summary table that is required for your assignments, and for any epidemiological analysis you do. The text format is fine, and convenient for moving into another pubication or presentation document. See the <a href="https://cran.r-project.org/web/packages/table1/vignettes/table1-examples.html">table1 vignette</a> for more examples.</p>
<p>WARNING: the counts in this table are incorrect, because each row corresponds to a number of counts of women using and not using contraceptives. We do this just to demo the table1 package, then make a correct table below after reshaping this dataset.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/benjaminrich/table1">table1</a></span><span class="op">)</span></pre></div>
<pre><code>## 
## Attaching package: 'table1'</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     units, units&lt;-</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/table1/man/table1.html">table1</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">cuse</span><span class="op">)</span></pre></div>
<p></p>
<div class="Rtable1"><table class="table Rtable1">
<thead><tr>
<th class="rowlabel firstrow lastrow"></th>
<th class="firstrow lastrow"><span class="stratlabel">Overall<br><span class="stratn">(N=16)</span></span></th>
</tr></thead>
<tbody>
<tr>
<td class="rowlabel firstrow"><span class="varlabel">age</span></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">&lt;25</td>
<td>4 (25.0%)</td>
</tr>
<tr>
<td class="rowlabel">25-29</td>
<td>4 (25.0%)</td>
</tr>
<tr>
<td class="rowlabel">30-39</td>
<td>4 (25.0%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">40-49</td>
<td class="lastrow">4 (25.0%)</td>
</tr>
<tr>
<td class="rowlabel firstrow"><span class="varlabel">education</span></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">low</td>
<td>8 (50.0%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">high</td>
<td class="lastrow">8 (50.0%)</td>
</tr>
<tr>
<td class="rowlabel firstrow"><span class="varlabel">wantsMore</span></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">no</td>
<td>8 (50.0%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">yes</td>
<td class="lastrow">8 (50.0%)</td>
</tr>
<tr>
<td class="rowlabel firstrow"><span class="varlabel">notUsing</span></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">Mean (SD)</td>
<td>68.8 (56.3)</td>
</tr>
<tr>
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">56.5 [8.00, 212]</td>
</tr>
<tr>
<td class="rowlabel firstrow"><span class="varlabel">using</span></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">Mean (SD)</td>
<td>31.7 (25.5)</td>
</tr>
<tr>
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">29.0 [4.00, 80.0]</td>
</tr>
</tbody>
</table></div> <strong>Table 1: characteristics of the contraceptive use dataset. Note, these counts correspond to number of rows in the dataset, <em>not</em> numbers of participants</strong>
</div>
<div id="definition-of-tidy-data" class="section level1">
<h1 class="hasAnchor">
<a href="#definition-of-tidy-data" class="anchor"></a>Definition of tidy data</h1>
<p><em>Excerpted from the <a href="https://vita.had.co.nz/papers/tidy-data.pdf">seminal paper by Hadley Wickam</a></em></p>
<blockquote>
<p>Happy families are all alike; every unhappy family is unhappy in its own way - Leo Tolstoy</p>
</blockquote>
<p>To summarize, in <strong>tidy data</strong>: 1. Each variable forms a column. 2. Each observation forms a row. 3. Each type of observational unit forms a table.</p>
<p><strong>Messy data</strong> is any other arrangement of the data. (according to Hadley and the tidyverse!)</p>
</div>
<div id="tidy-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#tidy-the-data" class="anchor"></a>Tidy the data</h1>
<p>First let’s do some work on the data to get it in shape for plotting. I do these one step at a time to show what’s happening, but you could also do chain these steps all together using the pipe operator (<code>%&gt;%</code>).</p>
<p>First, group by age and whether the participant reports wanting more children, and sum the number wanting or not wanting more children in each of these groups. Also rename “notUsing” to “not using” to make a nicer legend later.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></pre></div>
<pre><code>## Warning: package 'tidyverse' was built under R version 4.0.3</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✔ ggplot2 3.3.2     ✔ dplyr   1.0.2
## ✔ tibble  3.0.3     ✔ stringr 1.4.0
## ✔ tidyr   1.1.2     ✔ forcats 0.5.0
## ✔ purrr   0.3.4</code></pre>
<pre><code>## Warning: package 'purrr' was built under R version 4.0.3</code></pre>
<pre><code>## Warning: package 'stringr' was built under R version 4.0.3</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="va">cusebyage0</span> <span class="op">&lt;-</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">cuse</span>, <span class="va">age</span>, <span class="va">education</span>, <span class="va">wantsMore</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarise</span><span class="op">(</span>using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">using</span><span class="op">)</span>, <span class="st">"not using"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">notUsing</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## `summarise()` regrouping output by 'age', 'education' (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cusebyage0</span><span class="op">)</span></pre></div>
<pre><code>## # A tibble: 16 x 5
## # Groups:   age, education [8]
##    age   education wantsMore using `not using`
##    &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;     &lt;dbl&gt;       &lt;dbl&gt;
##  1 &lt;25   low       no            4          10
##  2 &lt;25   low       yes           6          53
##  3 &lt;25   high      no           10          50
##  4 &lt;25   high      yes          52         212
##  5 25-29 low       no           10          19
##  6 25-29 low       yes          14          60
##  7 25-29 high      no           27          65
##  8 25-29 high      yes          54         155
##  9 30-39 low       no           80          77
## 10 30-39 low       yes          33         112
## 11 30-39 high      no           78          68
## 12 30-39 high      yes          46         118
## 13 40-49 low       no           48          46
## 14 40-49 low       yes           6          35
## 15 40-49 high      no           31          12
## 16 40-49 high      yes           8           8</code></pre>
<p>Next, pivot this into a longer table by putting the “using” and “not using” columns into a single column called “contraceptive”. This pivot is necessary to make the data “tidy”.</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="va">cusebyage</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">cusebyage0</span>,
      cols <span class="op">=</span> <span class="va">using</span><span class="op">:</span><span class="st">"not using"</span>,
      values_to <span class="op">=</span> <span class="st">"n"</span>,
      names_to <span class="op">=</span> <span class="st">"contraceptive"</span><span class="op">)</span>
<span class="va">cusebyage</span></pre></div>
<pre><code>## # A tibble: 32 x 5
## # Groups:   age, education [8]
##    age   education wantsMore contraceptive     n
##    &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;     &lt;chr&gt;         &lt;dbl&gt;
##  1 &lt;25   low       no        using             4
##  2 &lt;25   low       no        not using        10
##  3 &lt;25   low       yes       using             6
##  4 &lt;25   low       yes       not using        53
##  5 &lt;25   high      no        using            10
##  6 &lt;25   high      no        not using        50
##  7 &lt;25   high      yes       using            52
##  8 &lt;25   high      yes       not using       212
##  9 25-29 low       no        using            10
## 10 25-29 low       no        not using        19
## # … with 22 more rows</code></pre>
</div>
<div id="a-correct-table-1" class="section level1">
<h1 class="hasAnchor">
<a href="#a-correct-table-1" class="anchor"></a>A correct table 1</h1>
<p>We can finally make a correct table1 with <em>one</em> more transformation, uncounting on the <code>n</code> column (using the tidyr package again). Also, we use <code>label</code> from the <code>table1</code> package to make more informative and readable labels. For interest, this time we stratify based on wanting more children, and add a caption. See <code><a href="https://rdrr.io/r/base/table.html">?table</a></code> for more options.</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="va">cuseverylong</span> <span class="op">&lt;-</span> <span class="fu">uncount</span><span class="op">(</span><span class="va">cusebyage</span>, <span class="va">n</span><span class="op">)</span> <span class="co">#from the tidyr package</span>
<span class="fu"><a href="https://rdrr.io/pkg/table1/man/label.html">label</a></span><span class="op">(</span><span class="va">cuseverylong</span><span class="op">$</span><span class="va">age</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Age (years)"</span>
<span class="fu"><a href="https://rdrr.io/pkg/table1/man/label.html">label</a></span><span class="op">(</span><span class="va">cuseverylong</span><span class="op">$</span><span class="va">education</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Education level"</span>
<span class="fu"><a href="https://rdrr.io/pkg/table1/man/label.html">label</a></span><span class="op">(</span><span class="va">cuseverylong</span><span class="op">$</span><span class="va">wantsMore</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Wants more children?"</span>
<span class="fu"><a href="https://rdrr.io/pkg/table1/man/label.html">label</a></span><span class="op">(</span><span class="va">cuseverylong</span><span class="op">$</span><span class="va">contraceptive</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Using contraceptives?"</span>
<span class="fu"><a href="https://rdrr.io/pkg/table1/man/table1.html">table1</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">|</span> <span class="va">wantsMore</span>, rowlabelhead <span class="op">=</span> <span class="st">"Wants more children?"</span>, 
       caption <span class="op">=</span> <span class="st">"Table 1: Participants in the contraceptive use study"</span>,
       data <span class="op">=</span> <span class="va">cuseverylong</span><span class="op">)</span></pre></div>
<div class="Rtable1"><table class="table Rtable1">
<caption>Table 1: Participants in the contraceptive use study</caption>

<thead><tr>
<th class="rowlabel firstrow lastrow">Wants more children?</th>
<th class="firstrow lastrow"><span class="stratlabel">no<br><span class="stratn">(N=635)</span></span></th>
<th class="firstrow lastrow"><span class="stratlabel">yes<br><span class="stratn">(N=972)</span></span></th>
<th class="firstrow lastrow"><span class="stratlabel">Overall<br><span class="stratn">(N=1607)</span></span></th>
</tr></thead>
<tbody>
<tr>
<td class="rowlabel firstrow"><span class="varlabel">Age (years)</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">&lt;25</td>
<td>74 (11.7%)</td>
<td>323 (33.2%)</td>
<td>397 (24.7%)</td>
</tr>
<tr>
<td class="rowlabel">25-29</td>
<td>121 (19.1%)</td>
<td>283 (29.1%)</td>
<td>404 (25.1%)</td>
</tr>
<tr>
<td class="rowlabel">30-39</td>
<td>303 (47.7%)</td>
<td>309 (31.8%)</td>
<td>612 (38.1%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">40-49</td>
<td class="lastrow">137 (21.6%)</td>
<td class="lastrow">57 (5.9%)</td>
<td class="lastrow">194 (12.1%)</td>
</tr>
<tr>
<td class="rowlabel firstrow"><span class="varlabel">Education level</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">low</td>
<td>294 (46.3%)</td>
<td>319 (32.8%)</td>
<td>613 (38.1%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">high</td>
<td class="lastrow">341 (53.7%)</td>
<td class="lastrow">653 (67.2%)</td>
<td class="lastrow">994 (61.9%)</td>
</tr>
<tr>
<td class="rowlabel firstrow"><span class="varlabel">Wants more children?</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">no</td>
<td>635 (100%)</td>
<td>0 (0%)</td>
<td>635 (39.5%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">yes</td>
<td class="lastrow">0 (0%)</td>
<td class="lastrow">972 (100%)</td>
<td class="lastrow">972 (60.5%)</td>
</tr>
<tr>
<td class="rowlabel firstrow"><span class="varlabel">Using contraceptives?</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">not using</td>
<td>347 (54.6%)</td>
<td>753 (77.5%)</td>
<td>1100 (68.5%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">using</td>
<td class="lastrow">288 (45.4%)</td>
<td class="lastrow">219 (22.5%)</td>
<td class="lastrow">507 (31.5%)</td>
</tr>
</tbody>
</table></div>
</div>
<div id="create-a-barplot" class="section level1">
<h1 class="hasAnchor">
<a href="#create-a-barplot" class="anchor"></a>Create a barplot</h1>
<p>See the <a href="https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf">Data Visualization Cheatsheet</a> for help on enhancing this barplot.</p>
<p>Now, make a sort of fancy greyscale barplot using ggplot2. You can make a nice plot without using nearly so many options, but I want to demonstrate the flexibility of making a bar plot with ggplot2.</p>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="fu">ggplot</span><span class="op">(</span><span class="va">cusebyage</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">wantsMore</span>, weight <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">contraceptive</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># create a stacked bar plot, where the values provided are counts/frequencies,</span>
  <span class="co"># and use black outlines for the bars.</span>
  <span class="fu">geom_bar</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"count"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># use facet_grid to separate the plots by age group</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">age</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Contraceptive usage counts"</span>,
       subtitle <span class="op">=</span> <span class="st">"in Contraceptive Use dataset"</span>,
       caption <span class="op">=</span> <span class="st">"Contraceptive use in study sample"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Wants more children?"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Number of Participants"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># there are lots of scale_fill_* options for automatic color schemes, but I </span>
  <span class="co"># just want to specify the colors manually here.</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></pre></div>
<p><img src="session_lab_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p><strong>Figure 1: contraceptive use in the study sample.</strong> Bar plot is organized by age group and stacked by self-report of whether participant wants more children. The fraction of women wanting more children decreases with age, becoming a minority in the 40-49 age group. One unexpected observation in this bar chart is that in the &lt;25 age group, those reporting wanting more children appear <em>more</em> likely to report using contraceptives. Is this the case? One way to make this more visually clear would be to use percentages, instead of counts, on the vertical scale. Try this, by changing <code>weight = n</code> to <code>weight = percent</code> to use the “percent” column as heights instead of the “n” column. While you’re at it, change the y label to reflect this change.</p>
<p><em>Note</em>: The caption option in <em>ggplot2</em> is suitable for smaller, embedded captions. But for publication the caption usually needs to be in separated text.</p>
</div>
<div id="try-yourself-plot-percentages-instead-of-counts" class="section level1">
<h1 class="hasAnchor">
<a href="#try-yourself-plot-percentages-instead-of-counts" class="anchor"></a>Try yourself: plot percentages instead of counts</h1>
<p>Here’s some code to calculate the percentages.</p>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="va">cusebyage</span> <span class="op">&lt;-</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">cusebyage</span>, <span class="va">age</span>, <span class="va">wantsMore</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>percent <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>
<span class="va">cusebyage</span></pre></div>
<pre><code>## # A tibble: 32 x 6
## # Groups:   age, wantsMore [8]
##    age   education wantsMore contraceptive     n percent
##    &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;     &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;
##  1 &lt;25   low       no        using             4    5.41
##  2 &lt;25   low       no        not using        10   13.5 
##  3 &lt;25   low       yes       using             6    1.86
##  4 &lt;25   low       yes       not using        53   16.4 
##  5 &lt;25   high      no        using            10   13.5 
##  6 &lt;25   high      no        not using        50   67.6 
##  7 &lt;25   high      yes       using            52   16.1 
##  8 &lt;25   high      yes       not using       212   65.6 
##  9 25-29 low       no        using            10    8.26
## 10 25-29 low       no        not using        19   15.7 
## # … with 22 more rows</code></pre>
<p>Now, can you repeat the barplot, but showing percentages instead of counts?</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://waldronlab.io">Levi Waldron</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
