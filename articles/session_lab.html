<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Session 2 lab exercise: Exploration of contraceptive use data • session2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Session 2 lab exercise: Exploration of contraceptive use data">
<meta property="og:description" content="session2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-176789980-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176789980-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">session2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lecture and Lab
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/session_lecture.html">Lecture notes</a>
    </li>
    <li>
      <a href="../articles/session_lecture.pdf">Lecture notes PDF</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../articles/session_lab.html">Lab materials</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waldronbios2/session2/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/leviwaldron1" class="external-link">
    <span class="fab fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><link href="session_lab_files/table1-1.0/table1_defaults.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Session 2 lab exercise: Exploration of
contraceptive use data</h1>
                        <h4 data-toc-skip class="author">Levi
Waldron</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waldronbios2/session2/blob/HEAD/vignettes/session_lab.Rmd" class="external-link"><code>vignettes/session_lab.Rmd</code></a></small>
      <div class="hidden name"><code>session_lab.Rmd</code></div>

    </div>

    
    
<p><strong>Learning Objectives</strong></p>
<ol style="list-style-type: decimal">
<li>Define “tidy” data</li>
<li>Load a dataset in R and perform basic exploratory data analysis</li>
<li>Create descriptive “Table 1” of a study sample using the
<code>table1</code> package</li>
<li>Create a customized bar plot using the <code>ggplot2</code>
package</li>
</ol>
<p><strong>Exercises</strong></p>
<ol style="list-style-type: decimal">
<li>Load the contraceptive use dataset into R</li>
<li>Create an “Epi Table 1” of sample characteristics</li>
<li>Create a barplot stratified by age and showing the relative
proportions of participants using contraceptives among those who do and
do not want more children.</li>
<li>Repeat the barplot showing percentages instead of counts</li>
</ol>
<div class="section level2">
<h2 id="load-the-contraceptive-use-data">Load the contraceptive use data<a class="anchor" aria-label="anchor" href="#load-the-contraceptive-use-data"></a>
</h2>
<p>Load the data from <a href="http://data.princeton.edu/wws509/datasets/#cuse" class="external-link uri">http://data.princeton.edu/wws509/datasets/#cuse</a>. From
this page:</p>
<blockquote>
<p>These data show the distribution of 1607 currently married and fecund
women interviewed in the Fiji Fertility Survey, according to age,
education, desire for more children and current use of
contraception.</p>
</blockquote>
<p>Unlike in the lecture, here I demonstrate reading the dataset using
the <em>readr</em> package. It identifies some warnings because the
header of this file has extra spaces at the end which appear like an
extra column, making it appear like the dataset has 6 columns instead of
5. But the dataset reads with 5 columns as we want it to anyways,
because I chose to skip the blank column 6 in the graphical interface
(which added the code <code>X6 = col_skip()</code> below).
<em>readr</em> is good for identifying problems like this in text data
files.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># traditional method for loading data:</span></span>
<span><span class="co"># cuse &lt;- read.table("cuse.dat", header=TRUE)</span></span>
<span><span class="co"># Using readr package with "File - Import Dataset" and manually setting factor levels.</span></span>
<span><span class="co"># Note, you don't have to write all this code by hand! It was produced by the File - Import Dataset helper.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="va">cuse</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html" class="external-link">read_table</a></span><span class="op">(</span></span>
<span>    <span class="st">"cuse.dat"</span>,</span>
<span>    col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span></span>
<span>      age <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html" class="external-link">col_factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;25"</span>, <span class="st">"25-29"</span>, <span class="st">"30-39"</span>, <span class="st">"40-49"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      education <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html" class="external-link">col_factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      wantsMore <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html" class="external-link">col_factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no"</span>, <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      X6 <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/col_skip.html" class="external-link">col_skip</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Missing column names filled in: 'X6' [6]</span></span></code></pre>
<pre><code><span><span class="co">## Warning: 16 parsing failures.</span></span>
<span><span class="co">## row col  expected    actual       file</span></span>
<span><span class="co">##   1  -- 6 columns 5 columns 'cuse.dat'</span></span>
<span><span class="co">##   2  -- 6 columns 5 columns 'cuse.dat'</span></span>
<span><span class="co">##   3  -- 6 columns 5 columns 'cuse.dat'</span></span>
<span><span class="co">##   4  -- 6 columns 5 columns 'cuse.dat'</span></span>
<span><span class="co">##   5  -- 6 columns 5 columns 'cuse.dat'</span></span>
<span><span class="co">## ... ... ......... ......... ..........</span></span>
<span><span class="co">## See problems(...) for more details.</span></span></code></pre>
<p>Note, these warnings relate to the presence of an empty column in the
dataset, which I dropped using <code>X6 = col_skip()</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/problems.html" class="external-link">problems</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cuse</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     age    education wantsMore    notUsing          using      </span></span>
<span><span class="co">##  &lt;25  :4   low :8    no :8     Min.   :  8.00   Min.   : 4.00  </span></span>
<span><span class="co">##  25-29:4   high:8    yes:8     1st Qu.: 31.00   1st Qu.: 9.50  </span></span>
<span><span class="co">##  30-39:4                       Median : 56.50   Median :29.00  </span></span>
<span><span class="co">##  40-49:4                       Mean   : 68.75   Mean   :31.69  </span></span>
<span><span class="co">##                                3rd Qu.: 85.75   3rd Qu.:49.00  </span></span>
<span><span class="co">##                                Max.   :212.00   Max.   :80.00</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="create-an-epi-table-1">Create an epi “Table 1”<a class="anchor" aria-label="anchor" href="#create-an-epi-table-1"></a>
</h2>
<p>Here’s a simple way to create the summary table that is required for
your assignments, and for any epidemiological analysis you do. The text
format is fine, and convenient for moving into another pubication or
presentation document. See the <a href="https://cran.r-project.org/web/packages/table1/vignettes/table1-examples.html" class="external-link">table1
vignette</a> for more examples.</p>
<p>WARNING: the counts in this table are incorrect, because each row
corresponds to a number of counts of women using and not using
contraceptives. We do this just to demo the table1 package, then make a
correct table below after reshaping this dataset.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/benjaminrich/table1" class="external-link">table1</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/table1.html" class="external-link">table1</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">cuse</span><span class="op">)</span></span></code></pre></div>
<div class="Rtable1"><table class="table Rtable1">
<thead><tr>
<th class="rowlabel firstrow lastrow"></th>
<th class="firstrow lastrow"><span class="stratlabel">Overall<br><span class="stratn">(N=16)</span></span></th>
</tr></thead>
<tbody>
<tr>
<td class="rowlabel firstrow">age</td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">
</td>
<td>4 (25.0%)</td>
</tr>
<tr>
<td class="rowlabel">25-29</td>
<td>4 (25.0%)</td>
</tr>
<tr>
<td class="rowlabel">30-39</td>
<td>4 (25.0%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">40-49</td>
<td class="lastrow">4 (25.0%)</td>
</tr>
<tr>
<td class="rowlabel firstrow">education</td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">low</td>
<td>8 (50.0%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">high</td>
<td class="lastrow">8 (50.0%)</td>
</tr>
<tr>
<td class="rowlabel firstrow">wantsMore</td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">no</td>
<td>8 (50.0%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">yes</td>
<td class="lastrow">8 (50.0%)</td>
</tr>
<tr>
<td class="rowlabel firstrow">notUsing</td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">Mean (SD)</td>
<td>68.8 (56.3)</td>
</tr>
<tr>
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">56.5 [8.00, 212]</td>
</tr>
<tr>
<td class="rowlabel firstrow">using</td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">Mean (SD)</td>
<td>31.7 (25.5)</td>
</tr>
<tr>
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">29.0 [4.00, 80.0]</td>
</tr>
</tbody>
</table></div>
<p><strong>Table 1: characteristics of the contraceptive use dataset.
Note, these counts correspond to number of rows in the dataset,
<em>not</em> numbers of participants</strong></p>
</div>
<div class="section level2">
<h2 id="definition-of-tidy-data">Definition of tidy data<a class="anchor" aria-label="anchor" href="#definition-of-tidy-data"></a>
</h2>
<p><em>Excerpted from the <a href="https://vita.had.co.nz/papers/tidy-data.pdf" class="external-link">seminal paper by
Hadley Wickam</a></em></p>
<blockquote>
<p>Happy families are all alike; every unhappy family is unhappy in its
own way - Leo Tolstoy</p>
</blockquote>
<p>To summarize, in <strong>tidy data</strong>: 1. Each variable forms a
column. 2. Each observation forms a row. 3. Each type of observational
unit forms a table.</p>
<p><strong>Messy data</strong> is any other arrangement of the data.
(according to Hadley and the tidyverse!)</p>
</div>
<div class="section level2">
<h2 id="tidy-the-data">Tidy the data<a class="anchor" aria-label="anchor" href="#tidy-the-data"></a>
</h2>
<p>First let’s do some work on the data to get it in shape for plotting.
I do these one step at a time to show what’s happening, but you could
also do chain these steps all together using the pipe operator
(<code>%&gt;%</code>).</p>
<p>First, group by age and whether the participant reports wanting more
children, and sum the number wanting or not wanting more children in
each of these groups. Also rename “notUsing” to “not using” to make a
nicer legend later.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">cusebyage0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cuse</span>, <span class="va">age</span>, <span class="va">education</span>, <span class="va">wantsMore</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">using</span><span class="op">)</span>, <span class="st">"not using"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">notUsing</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cusebyage0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 16 × 5</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   age, education [8]</span></span></span>
<span><span class="co">##    age   education wantsMore using `not using`</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> &lt;25   low       no            4          10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> &lt;25   low       yes           6          53</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> &lt;25   high      no           10          50</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> &lt;25   high      yes          52         212</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 25-29 low       no           10          19</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 25-29 low       yes          14          60</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 25-29 high      no           27          65</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 25-29 high      yes          54         155</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 30-39 low       no           80          77</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 30-39 low       yes          33         112</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> 30-39 high      no           78          68</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> 30-39 high      yes          46         118</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span> 40-49 low       no           48          46</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">14</span> 40-49 low       yes           6          35</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">15</span> 40-49 high      no           31          12</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">16</span> 40-49 high      yes           8           8</span></span></code></pre>
<p>Next, pivot this into a longer table by putting the “using” and “not
using” columns into a single column called “contraceptive”. This pivot
is necessary to make the data “tidy”.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cusebyage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">cusebyage0</span>,</span>
<span>      cols <span class="op">=</span> <span class="va">using</span><span class="op">:</span><span class="st">"not using"</span>,</span>
<span>      values_to <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"contraceptive"</span><span class="op">)</span></span>
<span><span class="va">cusebyage</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 32 × 5</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   age, education [8]</span></span></span>
<span><span class="co">##    age   education wantsMore contraceptive     n</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> &lt;25   low       no        using             4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> &lt;25   low       no        not using        10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> &lt;25   low       yes       using             6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> &lt;25   low       yes       not using        53</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> &lt;25   high      no        using            10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> &lt;25   high      no        not using        50</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> &lt;25   high      yes       using            52</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> &lt;25   high      yes       not using       212</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 25-29 low       no        using            10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 25-29 low       no        not using        19</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 22 more rows</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="a-correct-table-1">A correct table 1<a class="anchor" aria-label="anchor" href="#a-correct-table-1"></a>
</h2>
<p>We can finally make a correct table1 with <em>one</em> more
transformation, uncounting on the <code>n</code> column (using the tidyr
package again). Also, we use <code>label</code> from the
<code>table1</code> package to make more informative and readable
labels. For interest, this time we stratify based on wanting more
children, and add a caption. See <code><a href="https://rdrr.io/r/base/table.html" class="external-link">?table</a></code> for more
options.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cuseverylong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/uncount.html" class="external-link">uncount</a></span><span class="op">(</span><span class="va">cusebyage</span>, <span class="va">n</span><span class="op">)</span> <span class="co">#from the tidyr package</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/label.html" class="external-link">label</a></span><span class="op">(</span><span class="va">cuseverylong</span><span class="op">$</span><span class="va">age</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Age (years)"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/label.html" class="external-link">label</a></span><span class="op">(</span><span class="va">cuseverylong</span><span class="op">$</span><span class="va">education</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Education level"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/label.html" class="external-link">label</a></span><span class="op">(</span><span class="va">cuseverylong</span><span class="op">$</span><span class="va">wantsMore</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Wants more children?"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/label.html" class="external-link">label</a></span><span class="op">(</span><span class="va">cuseverylong</span><span class="op">$</span><span class="va">contraceptive</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Using contraceptives?"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/table1.html" class="external-link">table1</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">|</span> <span class="va">wantsMore</span>, rowlabelhead <span class="op">=</span> <span class="st">"Wants more children?"</span>, </span>
<span>       caption <span class="op">=</span> <span class="st">"Table 1: Participants in the contraceptive use study"</span>,</span>
<span>       data <span class="op">=</span> <span class="va">cuseverylong</span><span class="op">)</span></span></code></pre></div>
<div class="Rtable1"><table class="table Rtable1">
<caption>Table 1: Participants in the contraceptive use study</caption>

<thead><tr>
<th class="rowlabel firstrow lastrow">Wants more children?</th>
<th class="firstrow lastrow"><span class="stratlabel">no<br><span class="stratn">(N=635)</span></span></th>
<th class="firstrow lastrow"><span class="stratlabel">yes<br><span class="stratn">(N=972)</span></span></th>
<th class="firstrow lastrow"><span class="stratlabel">Overall<br><span class="stratn">(N=1607)</span></span></th>
</tr></thead>
<tbody>
<tr>
<td class="rowlabel firstrow">Age (years)</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">
</td>
<td>74 (11.7%)</td>
<td>323 (33.2%)</td>
<td>397 (24.7%)</td>
</tr>
<tr>
<td class="rowlabel">25-29</td>
<td>121 (19.1%)</td>
<td>283 (29.1%)</td>
<td>404 (25.1%)</td>
</tr>
<tr>
<td class="rowlabel">30-39</td>
<td>303 (47.7%)</td>
<td>309 (31.8%)</td>
<td>612 (38.1%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">40-49</td>
<td class="lastrow">137 (21.6%)</td>
<td class="lastrow">57 (5.9%)</td>
<td class="lastrow">194 (12.1%)</td>
</tr>
<tr>
<td class="rowlabel firstrow">Education level</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">low</td>
<td>294 (46.3%)</td>
<td>319 (32.8%)</td>
<td>613 (38.1%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">high</td>
<td class="lastrow">341 (53.7%)</td>
<td class="lastrow">653 (67.2%)</td>
<td class="lastrow">994 (61.9%)</td>
</tr>
<tr>
<td class="rowlabel firstrow">Using contraceptives?</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">not using</td>
<td>347 (54.6%)</td>
<td>753 (77.5%)</td>
<td>1100 (68.5%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">using</td>
<td class="lastrow">288 (45.4%)</td>
<td class="lastrow">219 (22.5%)</td>
<td class="lastrow">507 (31.5%)</td>
</tr>
</tbody>
</table></div>
<p>Note, there are at least several other packages for making the epi
“Table 1”. Take a look to see if any of them appeal to you: * <a href="https://cran.r-project.org/web/packages/desctable/vignettes/desctable.html" class="external-link">desctable</a>:
powerful, provides a “download Excel” button in html output. * <a href="https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html" class="external-link">kableExtra</a>:
very powerful and flexible for formatting and features. Requires a
little more code to get to your table 1. * <a href="https://cran.r-project.org/web/packages/tableone/vignettes/introduction.html" class="external-link">tableone</a>:
simple and text-based, but works quite well and has options for
exporting to Excel for use in a manuscript.</p>
</div>
<div class="section level2">
<h2 id="create-a-barplot">Create a barplot<a class="anchor" aria-label="anchor" href="#create-a-barplot"></a>
</h2>
<p>See the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf" class="external-link">Data
Visualization with ggplot2 Cheatsheet</a> for help on enhancing this
barplot.</p>
<p>Now, make a sort of fancy greyscale barplot using ggplot2. You can
make a nice plot without using nearly so many options, but I want to
demonstrate the flexibility of making a bar plot with ggplot2.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cusebyage</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wantsMore</span>, weight <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">contraceptive</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># create a stacked bar plot, where the values provided are counts/frequencies,</span></span>
<span>  <span class="co"># and use black outlines for the bars.</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"count"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># use facet_grid to separate the plots by age group</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">age</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Contraceptive usage counts"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"in Contraceptive Use dataset"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Contraceptive use in study sample"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Wants more children?"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Number of Participants"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># there are lots of scale_fill_* options for automatic color schemes, but I </span></span>
<span>  <span class="co"># just want to specify the colors manually here.</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="session_lab_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p><strong>Figure 1: contraceptive use in the study sample.</strong> Bar
plot is organized by age group and stacked by self-report of whether
participant wants more children. The fraction of women wanting more
children decreases with age, becoming a minority in the 40-49 age group.
One unexpected observation in this bar chart is that in the &lt;25 age
group, those reporting wanting more children appear <em>more</em> likely
to report using contraceptives. Is this the case? One way to make this
more visually clear would be to use percentages, instead of counts, on
the vertical scale. Try this, by changing <code>weight = n</code> to
<code>weight = percent</code> to use the “percent” column as heights
instead of the “n” column. While you’re at it, change the y label to
reflect this change.</p>
<p><em>Note</em>: The caption option in <em>ggplot2</em> is suitable for
smaller, embedded captions. But for publication the caption usually
needs to be in separated text.</p>
</div>
<div class="section level2">
<h2 id="try-yourself-plot-percentages-instead-of-counts">Try yourself: plot percentages instead of counts<a class="anchor" aria-label="anchor" href="#try-yourself-plot-percentages-instead-of-counts"></a>
</h2>
<p>Here’s some code to calculate the percentages.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cusebyage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cusebyage</span>, <span class="va">age</span>, <span class="va">wantsMore</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>percent <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">cusebyage</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 32 × 6</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   age, wantsMore [8]</span></span></span>
<span><span class="co">##    age   education wantsMore contraceptive     n percent</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> &lt;25   low       no        using             4    5.41</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> &lt;25   low       no        not using        10   13.5 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> &lt;25   low       yes       using             6    1.86</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> &lt;25   low       yes       not using        53   16.4 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> &lt;25   high      no        using            10   13.5 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> &lt;25   high      no        not using        50   67.6 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> &lt;25   high      yes       using            52   16.1 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> &lt;25   high      yes       not using       212   65.6 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 25-29 low       no        using            10    8.26</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 25-29 low       no        not using        19   15.7 </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 22 more rows</span></span></span></code></pre>
<p>Now, can you repeat the barplot, but showing percentages instead of
counts?</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://waldronlab.io" class="external-link">Levi Waldron</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
